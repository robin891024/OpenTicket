import { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";

function MemberInfo() {
    const navigate = useNavigate();
    const [message, setMessage] = useState("");
    const [account, setAccount] = useState("Loading...");
    const [city, setCity] = useState("Loading...");
    const [name, setName] = useState("Loading...");

    useEffect(() => {
        fetch("http://localhost:8080/member/profile", {
            credentials: 'include'
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                setAccount(data.account);
                setName(data.name);
                setCity(data.city)
            })
            .catch(() => {
                setMessage('無法載入會員資料');
            });
    }, []);

    return (
        <main className="member-content">
            {message}
            <div className="content-wrapper">
                {/* 會員資訊卡片 */}
                <div className="info-card">
                    <div className="card-header">
                        <h2 className="card-title">會員資訊</h2>
                    </div>
                    
                    <div className="info-list">
                        {/* 帳號 */}
                        <div className="info-item">
                            <div className="info-item-content">
                                <div className="info-icon">
                                    <span className="material-symbols-outlined">account_circle</span>
                                </div>
                                <div className="info-details">
                                    <p className="info-label">帳號</p>
                                    <p className="info-value">{account}</p>
                                </div>
                            </div>
                        </div>

                        {/* 密碼 */}
                        <div className="info-item">
                            <div className="info-item-content">
                                <div className="info-icon">
                                    <span className="material-symbols-outlined">lock</span>
                                </div>
                                <div className="info-details">
                                    <p className="info-label">密碼</p>
                                    <p className="info-value">••••••••</p>
                                </div>
                            </div>
                            <button className="edit-button" onClick={() => navigate('/member/revise/password')}>
                                <span>修改</span>
                            </button>
                        </div>

                        {/* 姓名 */}
                        <div className="info-item">
                            <div className="info-item-content">
                                <div className="info-icon">
                                    <span className="material-symbols-outlined">badge</span>
                                </div>
                                <div className="info-details">
                                    <p className="info-label">姓名</p>
                                    <p className="info-value">{name}</p>
                                </div>
                            </div>
                            <button className="edit-button" onClick={() => navigate('/member/revise/name')}>
                                <span>修改</span>
                            </button>
                        </div>

                        {/* 居住地 */}
                        <div className="info-item">
                            <div className="info-item-content">
                                <div className="info-icon">
                                    <span className="material-symbols-outlined">home</span>
                                </div>
                                <div className="info-details">
                                    <p className="info-label">居住地</p>
                                    <p className="info-value">{city}</p>
                                </div>
                            </div>
                            <button className="edit-button" onClick={() => navigate('/member/revise/city')}>
                                <span>修改</span>
                            </button>
                        </div>
                    </div>
                </div>

                {/* 行事曆卡片 */}
                <div className="calendar-card">
                    <div className="calendar-placeholder">
                        <p>行事曆</p>
                    </div>
                </div>

                {/* Debug 訊息 (可選) */}
                {/* {process.env.NODE_ENV === 'development' && (
                    <div className="debug-message">
                        <p className="debug-title">API 回應：</p>
                        <pre className="debug-content">{message}</pre>
                    </div>
                )} */}
            </div>
        </main>
    );
}

export default MemberInfo;